<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>PIAACMCdesign: PIAACMC design</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">PIAACMCdesign
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md_src_PIAACMCsimul_README.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">PIAACMC design </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="el" href="md_src_PIAACMCsimul_README.html#overview"><ol type="1">
<li>Overview</li>
</ol>
</a> <a class="el" href="md_src_PIAACMCsimul_README.html#code"><ol type="1">
<li>C code description</li>
</ol>
</a> bashscript <a class="el" href="md_src_PIAACMCsimul_README.html#desstep"><ol type="1">
<li>Design Steps for PIAACMC</li>
</ol>
</a></p><ul>
<li><a class="el" href="md_src_PIAACMCsimul_README.html#initrules">3.a. Initialization rules (function PIAAsimul_initpiaacmc() )</a></li>
<li><a class="el" href="md_src_PIAACMCsimul_README.html#mode000">3.000. MODE 000: Create an idealized centrally obscured apodized PIAACMC monochromatic design</a></li>
<li>step001</li>
<li><a class="el" href="md_src_PIAACMCsimul_README.html#step002">3.002. STEP 002: Specify input pupil geometry</a></li>
</ul>
<h1><a class="anchor" id="overview"></a>
1. Overview</h1>
<p>Diffraction-based PIAACMC simulation / optimization</p><ul>
<li>Uses Fresnel propagation engine ( <a class="el" href="OptSystProp_8c.html">OptSystProp.c</a> <a class="el" href="OptSystProp_8h.html">OptSystProp.h</a> ) between optical elements</li>
<li>Computes linear perturbations around current design for optimization</li>
<li>Automatically computes multiple Lyot stop to follow variable conjugation in different parts of the beam</li>
<li>Polychromatic propagations</li>
<li>Fits aspheric PIAA shapes on basis of radial cosines and 2-D Fourier modes</li>
</ul>
<p>Code is composed of a several layers (from high to low) :</p><ul>
<li>high level design script: script "runopt"</li>
<li>script "sim1024"</li>
<li>script "runPIAACMC"</li>
<li>C code</li>
</ul>
<h1><a class="anchor" id="scripts"></a>
2. High level scripts</h1>
<p>Scripts are located in src/PIAACMCsimul/scripts</p>
<p>TOP LEVEL SCRIPT: <br />
./runopt<br />
This script can optimize a PIAACMC design or run an existing design<br />
Type command with no argument to get help</p>
<p>runopt calls lower level scripts sim1024</p>
<p>./sim1024<br />
This script sequences operations<br />
Type ./sim1024 with no argument to get help message.</p>
<p>sim1024 calls runPIAACMC</p>
<p>./runPIAACMC<br />
This is the lower-level script calling the C-written executable<br />
Type ./runPIAACMC with no argument to get help message.</p>
<h1><a class="anchor" id="code"></a>
3. C code description</h1>
<p><a class="el" href="PIAACMC_designcodes.html">PIAACMC design codes</a></p>
<p>The main function in the source code is <a class="el" href="PIAACMCsimul_8c.html#a1083c078214e43d74447950f8a236c5d" title="Main simulation routine. ">PIAACMCsimul_exec()</a>, which takes two arguments: the configuration index (usually a 3 digit integer) and the mode (integer) which describes the operation to be performed to the PIAACMC design.</p>
<table class="doxtable">
<tr>
<th>Mode </th><th>Description  </th></tr>
<tr>
<td>0 * </td><td>Compute on-axis propagation for specified configuration. If configuration does not exist, create idealized monochromatic PIAACMC (intended to create a new index) and compute on-axis propagation </td></tr>
<tr>
<td>1 * </td><td>Optimize Lyot stop(s) locations (scan) </td></tr>
<tr>
<td>2 * </td><td>Optimize focal plane mask transmission for idealized monochromatic PIAACMC (scan) </td></tr>
<tr>
<td>3 </td><td>Run without focal plane mask (for testing and calibration) </td></tr>
<tr>
<td>4 </td><td>Linear optimization around current design, free parameters = PIAA optics cosines shapes (track progress by looking at val.opt file) </td></tr>
<tr>
<td>5 * </td><td>Optimize Lyot stops shapes and positions </td></tr>
<tr>
<td>10 * </td><td>Setup polychromatic optimization </td></tr>
<tr>
<td>11 * </td><td>Compute polychromatic response to zones, store result in FPMresp </td></tr>
<tr>
<td>12 </td><td>Search for best mask solution using FPMresp, random search </td></tr>
<tr>
<td>13 * </td><td>Optimize PIAA optics shapes and focal plane mask transmission (idealized PIAACMC) </td></tr>
<tr>
<td>40 * </td><td>Optimize PIAA optics shapes and focal plane mask transmission (idealized PIAACMC) </td></tr>
<tr>
<td>41 </td><td>Optimize PIAA optics shapes and focal plane mask zones (polychromatic) </td></tr>
<tr>
<td>100 * </td><td>Evaluate current design: polychromatic contrast, pointing sensitivity </td></tr>
<tr>
<td>101 * </td><td>Transmission as a function of angular separation </td></tr>
<tr>
<td>200 * </td><td>Make focal plane mask OPD map </td></tr>
</table>
<p>The following variables can be set</p>
<table class="doxtable">
<tr>
<th>Variable </th><th>Description  </th></tr>
<tr>
<td>PIAACMC_size </td><td>Array size (1024, 2048, etc...) </td></tr>
<tr>
<td>PIAACMC_pixscale </td><td>Pixel scale [m] </td></tr>
<tr>
<td>PIAACMC_dftgrid </td><td>Sampling interval in DFTs </td></tr>
<tr>
<td>PIAACMC_centobs0 </td><td>Input central obstruction </td></tr>
<tr>
<td>PIAACMC_centobs1 </td><td>Output central obstruction </td></tr>
<tr>
<td>PIAACMC_nblambda </td><td>Number of wavelength points </td></tr>
<tr>
<td>PIAACMC_resolved </td><td>1 if resolved source (3 points at r = 0.01 l/D, 120 deg apart) </td></tr>
<tr>
<td>PIAACMC_fpmtype </td><td>1 if physical mask, 0 if idealized mask </td></tr>
<tr>
<td>PIAACMC_FPMsectors </td><td>Number of sectors in focal plane mask </td></tr>
<tr>
<td>PIAACMC_NBrings </td><td>Number of rings in focal plane mask </td></tr>
<tr>
<td>PIAACMC_fpmradld </td><td>Focal plane mask outer radius </td></tr>
</table>
<h1><a class="anchor" id="desstep"></a>
4. Design Steps for PIAACMC</h1>
<p>Directories "./piaacmcconf&lt;nnn&gt;/" hold the default/current configuration settings and files for the PIAACMC. The directory will be automatically created if it does not exist. By copying from/to this directory, you can save/load PIAACMC designs.<br />
 By default, if no configuration file exists, a monochromatic PIAACMC for a centrally obscured pupil will be created. This is meant as a starting point for the PIAACMC, which will then be optimized further<br />
 The main command to run the PIAACMC simulation is </p><pre class="fragment">&lt;executable&gt;
piaacmcsimrun &lt;nnn&gt; &lt;mode&gt;
exit
</pre><p>where &lt;nnn&gt; [long] is the configuration index and &lt;mode&gt; [long] defines the operation to be performed.<br />
See function PIAACMCsimul_run(long confindex, long mode) for list of modes<br />
 The PIAACMC design process is as follows:</p><ol type="1">
<li>design an idealized monochromatic PIAACMC for a centrally obscured aperture (steps 1-4)</li>
<li>modify the design for the pupil aperture (steps 5-)</li>
</ol>
<h2><a class="anchor" id="initrules"></a>
3.a. Initialization rules (function  PIAAsimul_initpiaacmc() )</h2>
<ol type="1">
<li>if configuration directory exists, use it and load configuration file ( function PIAAsimul_loadpiaacmcconf ), otherwise, create it</li>
<li>load/create Cmodes</li>
<li>load/create Fmodes</li>
<li>load mode coefficients for piaa shapes if they exist. If not:<ol type="a">
<li>create radial apodization for centrally obscured idealized monochromatic PIAACMC</li>
<li>fit / extrapolate radial apodization profile with cosines</li>
<li>using above fit, create 2D radial sag for both PIAA optics ( -&gt; PIAA_Mshapes.txt)</li>
<li>make 2D sag maps for both optics ( -&gt; piaa0z.fits, piaa1z.fits)</li>
<li>fit 2D sag maps with Cmodes and Fmodes coefficients ( -&gt; piaa0Cmodes, piaa0Fmodes, piaa1Cmodes, piaa1Fmodes )</li>
</ol>
</li>
<li>load/create focal plane mask zone map. This is the map that defines the geometry (which ring is where)</li>
<li>load/create focal plane mask thickness array</li>
<li>load/create focal plane mask transmission array</li>
<li>load/create Lyot stops</li>
</ol>
<h2><a class="anchor" id="mode000"></a>
3.000. MODE 000: Create an idealized centrally obscured apodized PIAACMC monochromatic design</h2>
<p>This is meant as a starting point for the PIAACMC, which will then be optimized further<br />
Optional parameters are:</p><ul>
<li>PIAACMC_size : array size (default = 1024)</li>
<li>PIAACMC_pixscale : pixel scale (m/pix)</li>
<li>PIAACMC_nblambda : number of wavelengths (1 for monochromatic)</li>
<li>PIAACMC_dftgrid : DFT grid sampling gap [pix] in pupil plane</li>
<li>PIAACMC_centobs0 : central obstruction in input pupil (default = 0.3)</li>
<li>PIAACMC_centobs1 : central obstruction after remapping (default = 0.2)</li>
<li>PIAACMC_fpmradld : focal plane mask radius for monochromatic idealized design, in l/D system unit (default = 0.9)</li>
</ul>
<pre class="fragment">&lt;executable&gt;
PIAACMC_size=1024
PIAACMC_pixscale=0.00011
PIAACMC_nblambda=1
PIAACMC_dftgrid=2
PIAACMC_centobs0=0.3
PIAACMC_centobs1=0.15
PIAACMC_fpmradld=1.0
PIAACMC_dftgrid=2
piaacmcsimrun 0 0
exit
</pre><p>This will create the prolate function for a centrally obscured pupil, the idealized focal plane mask, and run the diffraction propagation.<br />
This step takes a few minutes - most of the time is spent on iterations to compute the 2D apodization prolate function.<br />
 Run this twice: once to set up the configuration, and once to run the on-axis PSF.<br />
 After this step, the contrast will likely be around 1e-7. The next step to improve this nominal design is to find the optimal locations for the Lyot stops.<br />
 Example result (for 1 l/D mask, 2048 array size): </p><pre class="fragment">Peak constrast (rough estimate)= 2.02762e-06
Total light in scoring field = 9.49968e-06  -&gt; Average contrast = 6.88685e-08
</pre><h3>Code breakdown</h3>
<ul>
<li><a class="el" href="PIAACMCsimul_8c.html#a1083c078214e43d74447950f8a236c5d" title="Main simulation routine. ">PIAACMCsimul_exec()</a> :<ul>
<li><a class="el" href="PIAACMCsimul_8c.html#a85f1459cf776292b7e2fff9932a79252" title="Creates/initializes piaacmcconf structure and directory. ">PIAAsimul_initpiaacmcconf()</a>: Load/Creates/initializes piaacmcconf structure and directory<ul>
<li>perform default initialization</li>
<li><a class="el" href="PIAACMCsimul_8c.html#adedec73128f41e8b3f83796bf913c8da">PIAAsimul_loadpiaacmcconf()</a>: Loading PIAACMC configuration from "piaacmcconfxxx/piaacmcparams.conf" if it exists</li>
<li>Creating/loading Cmodes and Fmodes</li>
<li>IMPORT / CREATE PIAA SHAPES<ul>
<li>create 2D prolate iteratively</li>
<li><a class="el" href="PIAACMCsimul_8c.html#a6828d3577dee2b0882bd7df99602f30d">PIAACMCsimul_load2DRadialApodization()</a>:fit PIAA shapes with Cosine modes</li>
<li><a class="el" href="PIAACMCsimul_8c.html#a8e2b36e622c11627571989ab113d85eb">PIAACMCsimul_init_geomPIAA_rad()</a>: compute radial PIAA sag from cosine apodization fit</li>
<li><a class="el" href="PIAACMCsimul_8c.html#adad6ba0da7cd47c07c35232b6096fa1c">PIAACMCsimul_mkPIAAMshapes_from_RadSag()</a>: Make 2D sag shapes from radial PIAA sag</li>
</ul>
</li>
<li>MAKE FOCAL PLANE MASK</li>
<li>MAKE LYOT STOPS</li>
<li><a class="el" href="PIAACMCsimul_8c.html#aac928f8658448934caa7e805af8606a8">PIAAsimul_savepiaacmcconf()</a>: save configuration</li>
</ul>
</li>
<li><a class="el" href="PIAACMCsimul_8c.html#a0ae7439a20fe5267506bc7d1e0533f08">PIAACMCsimul_makePIAAshapes()</a>: construct PIAA shapes from fitting coefficients<ul>
<li>construct 2D PIAA mirror shapes from piaa0Cmodescoeff, piaa0Fmodescoeff, piaa1Cmodescoeff, piaa1Fmodescoeff</li>
</ul>
</li>
<li><a class="el" href="PIAACMCsimul_8c.html#a0650545f10bc1e359093510f12a9f9f6">PIAACMCsimul_computePSF()</a>: Compute PSF</li>
</ul>
</li>
</ul>
<h3>Output Files</h3>
<p>APLCmaskCtransm.txt ?? fpm_ampl.fits fpm_pha.fits FPmask.tmp.fits</p>
<h4>Configuration :</h4>
<table class="doxtable">
<tr>
<th>Output file </th><th>Notes  </th></tr>
<tr>
<td>./piaaconfxxx/piaacmcparams.conf </td><td>Configuration parameters </td></tr>
<tr>
<td>./piaaconfxxx/conjugations.txt </td><td>Conjugations </td></tr>
<tr>
<td>./piaaconfxxx/lambdalist.txt </td><td>list of wavelength values </td></tr>
<tr>
<td>./piaaconfxxx/pupa0_[size].fits </td><td>input pupil (created by default if does not exist) </td></tr>
</table>
<h4>Wavefront Modes :</h4>
<table class="doxtable">
<tr>
<th>Output file </th><th>Notes  </th></tr>
<tr>
<td>Cmodes.fits </td><td>circular radial cosine modes (40 modes, hard coded) </td></tr>
<tr>
<td>Fmodes.fits </td><td>Fourier modes (625 modes = 10 CPA, hard coded) </td></tr>
<tr>
<td>./piaaconfxxx/ModesExpr_CPA.txt </td><td>modes definition </td></tr>
<tr>
<td>./piaaconfxxx/APOmodesCos.fits </td><td>Cosine modes for fitting 2D apodization profile </td></tr>
</table>
<h4>PIAA mirrors, apodization, fits:</h4>
<table class="doxtable">
<tr>
<th>Output file </th><th>Notes  </th></tr>
<tr>
<td>./piaaconfxxx/APLCapo.1.400.0.300.info </td><td>file written by prolate generation function coronagraph_make_2Dprolate in <a class="el" href="coronagraphs_8c.html">coronagraphs.c</a> </td></tr>
<tr>
<td>./piaaconfxxx/apo2Drad.fits </td><td>idealized PIAACMC 2D apodization </td></tr>
<tr>
<td>./piaaconfxxx/piaam0z.fits </td><td>PIAA M0 shape (2D sag) </td></tr>
<tr>
<td>./piaaconfxxx/piaam1z.fits </td><td>PIAA M1 shape (2D sag) </td></tr>
<tr>
<td>./piaaconfxxx/PIAA_Mshapes.txt </td><td>PIAA shapes (radial txt file, cols: r0, z0, r1, z1) </td></tr>
<tr>
<td>./piaaconfxxx/piaa0Fz.fits </td><td>PIAA M0 shape, Fourier components (2D file) </td></tr>
<tr>
<td>./piaaconfxxx/piaa1Fz.fits </td><td>PIAA M1 shape, Fourier components (2D file) </td></tr>
<tr>
<td>./piaaconfxxx/piaa0Cmodes.fits </td><td>idealized PIAACMC mirror 0 cosine modes (copied from ./piaaref/) </td></tr>
<tr>
<td>./piaaconfxxx/piaa0Fmodes.fits </td><td>idealized PIAACMC mirror 0 Fourier modes (copied from ./piaaref/) </td></tr>
<tr>
<td>./piaaconfxxx/piaa1Cmodes.fits </td><td>idealized PIAACMC mirror 1 cosine modes (copied from ./piaaref/) </td></tr>
<tr>
<td>./piaaconfxxx/piaa1Fmodes.fits </td><td>idealized PIAACMC mirror 1 Fourier modes (copied from ./piaaref/) </td></tr>
<tr>
<td>./piaaconfxxx/piaa0Cres.fits </td><td>idealized PIAA M0 cosine fit residual </td></tr>
<tr>
<td>./piaaconfxxx/piaa1Cres.fits </td><td>idealized PIAA M1 cosine fit residual </td></tr>
<tr>
<td>./piaaconfxxx/piaa0Cz.fits </td><td>idealized PIAA M0 cosine fit sag </td></tr>
<tr>
<td>./piaaconfxxx/piaa1Cz.fits </td><td>idealized PIAA M1 cosine fit sag </td></tr>
<tr>
<td>./piaaconfxxx/piaa0Fz.fits </td><td>idealized PIAA M0 Fourier fit sag </td></tr>
<tr>
<td>./piaaconfxxx/piaa1Fz.fits </td><td>idealized PIAA M1 Fourier fit sag </td></tr>
</table>
<h4>Idealized PIAACMC reference point:</h4>
<table class="doxtable">
<tr>
<th>Output file </th><th>Notes  </th></tr>
<tr>
<td>./piaaconfxxx/piaaref/APLCmaskCtransm.txt </td><td>idealized PIAACMC focal plane mask transmission </td></tr>
<tr>
<td>./piaaconfxxx/piaaref/apo2Drad.fits </td><td>idealized PIAACMC output apodization </td></tr>
<tr>
<td>./piaaconfxxx/piaaref/piaa0Cmodes.fits </td><td>idealized PIAACMC mirror 0 cosine modes </td></tr>
<tr>
<td>./piaaconfxxx/piaaref/piaa0Fmodes.fits </td><td>idealized PIAACMC mirror 0 Fourier modes </td></tr>
<tr>
<td>./piaaconfxxx/piaaref/piaa1Cmodes.fits </td><td>idealized PIAACMC mirror 1 cosine modes </td></tr>
<tr>
<td>./piaaconfxxx/piaaref/piaa1Fmodes.fits </td><td>idealized PIAACMC mirror 1 Fourier modes </td></tr>
</table>
<h4>Focal plane mask:</h4>
<p>Focal plane mask design defined by :</p><ul>
<li>[s] Sectors flag (0: no sectors, 1: sectors), variable PIAACMC_FPMsectors</li>
<li>[r] Resolved target flag (0: point source, 1: resolved source)</li>
<li>[mr] Mask radius in units of 0.1 l/D</li>
<li>[rrr] number of rings, variable piaacmc[0].NBrings</li>
<li>[zzz] number of zones</li>
</ul>
<table class="doxtable">
<tr>
<th>Output file </th><th>Notes  </th></tr>
<tr>
<td>fpmzmap[s]_[rrr]_[zzz].fits </td><td>Zones map </td></tr>
<tr>
<td>fpm_zonea[r][s]_[mr]_[rrr]_[zzz].fits </td><td>amplitude for each zone </td></tr>
<tr>
<td>fpm_zonea[r][s]_[mr]_[rrr]_[zzz].fits </td><td>thickness for each zone </td></tr>
</table>
<p>IDEALIZED OR PHYSICAL MASK<br />
 Idealized mask is a single zone mask with thickness adjusted for lambda/2 phase shift and a (non-physical) partial transmission. Physical mask consist of 1 or more zones with full transmission. Each zone can have a different thickness.</p>
<p>By default, a non-physical mask is first created with transmission piaacmc[0].fpmaskamptransm read from piaacmcparams.conf. Computations indices using a physical mask:</p><ul>
<li>set transmission to 1.0: piaacmc[0].fpmaskamptransm = 1.0.</li>
<li>set focal plane mask radius to larger value: piaacmc[0].fpmRad = 0.5*(LAMBDASTART+LAMBDAEND)*piaacmc[0].Fratio * PIAACMC_MASKRADLD</li>
</ul>
<h4>Lyot stops:</h4>
<table class="doxtable">
<tr>
<th>Output file </th><th>Notes  </th></tr>
<tr>
<td>./piaaconfxxx/LyotStop0.fits </td><td>Lyot Stop 0 </td></tr>
<tr>
<td>./piaaconfxxx/LyotStop1.fits </td><td>Lyot Stop 1 </td></tr>
</table>
<h4>Amplitude &amp; Phase at planes:</h4>
<p>Files are /piaaconfxxx/WFamp_nnn.fits and WFpha_nnn.fits, where nnn is the plane index.<br />
Complex amplitude is shown AFTER the element has been applied, in the plane of the element.<br />
 </p><table class="doxtable">
<tr>
<th>Plane index </th><th>description  </th></tr>
<tr>
<td>000 </td><td>Input pupil </td></tr>
<tr>
<td>001 </td><td>Fold mirror used to induce pointing offsets </td></tr>
<tr>
<td>002 </td><td>PIAA M0 </td></tr>
<tr>
<td>003 </td><td>PIAA M1 </td></tr>
<tr>
<td>004 </td><td>PIAAM1 edge opaque mask </td></tr>
<tr>
<td>005 </td><td>post-focal plane mask pupil </td></tr>
<tr>
<td>006 </td><td>Lyot Stop 0 </td></tr>
<tr>
<td>007 </td><td>Lyot Stop 1 </td></tr>
<tr>
<td>008 </td><td>invPIAA1 </td></tr>
<tr>
<td>009 </td><td>invPIAA0 </td></tr>
<tr>
<td>010 </td><td>back end mask </td></tr>
</table>
<h4>Performance Evaluation:</h4>
<table class="doxtable">
<tr>
<th>Plane index </th><th>description  </th></tr>
<tr>
<td>./piaaconfxxx/scoringmask0.fits </td><td>Evaluation points in focal plane, hardcoded in <a class="el" href="PIAACMCsimul_8c.html#a0650545f10bc1e359093510f12a9f9f6">PIAACMCsimul_computePSF()</a> </td></tr>
<tr>
<td>./piaaconfxxx/CnormFactor.txt </td><td>PSF normalization factor used to compute contrast </td></tr>
<tr>
<td>./piaaconfxxx/flux.txt </td><td>total intensity at each plane </td></tr>
</table>
<h2><a class="anchor" id="step002"></a>
3.002. STEP 002: Specify input pupil geometry</h2>
<p>The pupil geometry is copied to file ./piaacmcconf[nnn]/pupa0_[size].fits</p>
<h2><a class="anchor" id="step003"></a>
3.003. STEP 003 (mode = 0): compute on-axis PSF for new pupil geometry</h2>
<h2><a class="anchor" id="step004"></a>
3.004. STEP 004 (mode = 5): Compute Lyot stops shapes and locations, 1st pass</h2>
<p>For circular centrally obscured pupils, the default Lyot stops configuration consists of two stops: one that masks the outer part of the beam, and one that masks the central obstruction.<br />
 Fine optimization of the stops locations is done with a separate command. The optional lsoptrange value is the range (unit: m) for the mask position search (default = 2 m).<br />
</p>
<p>Example result (for 1 l/D mask, 2048 array size): </p><pre class="fragment">Peak constrast (rough estimate)= 1.78874e-06
Total light in scoring field = 7.75534e-06  -&gt; Average contrast = 5.62228e-08
</pre><h2><a class="anchor" id="step005"></a>
3.005. STEP 005 (mode = 2): Optimize focal plane mask transmission, 1st pass</h2>
<h2><a class="anchor" id="step006"></a>
3.006. STEP 006 (mode = 5): Compute Lyot stops shapes and locations, 2nd pass, 70% throughput</h2>
<h2><a class="anchor" id=""></a>
</h2>
<p>This takes approximately 20mn for size = 1024.<br />
Progress can be tracked by watching file : </p><pre class="fragment">tail -f linoptval.txt
</pre><h2><a class="anchor" id=""></a>
</h2>
<h2><a class="anchor" id=""></a>
</h2>
<h2><a class="anchor" id=""></a>
</h2>
<h2><a class="anchor" id=""></a>
</h2>
<h2><a class="anchor" id=""></a>
</h2>
<p>The total number of free parameters is 380 = (40+150)*2, so this routine takes a long time to complete (hours).</p>
<h2><a class="anchor" id=""></a>
</h2>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed Jul 8 2015 16:50:17 for PIAACMCdesign by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.8 </li>
  </ul>
</div>
</body>
</html>
